---
permalink: /
layout: wide
title: Home
---
<script
  src="https://code.jquery.com/jquery-3.4.1.min.js"
  integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
  crossorigin="anonymous"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/list.js/1.5.0/list.min.js"></script>
<script>

$(document).ready( function () {
  // JQuery plugin
  // case insensitive jquery text search
  jQuery.expr[':'].icontains = function(a, i, m) {
    return jQuery(a).text().toUpperCase()
      .indexOf(m[3].toUpperCase()) >= 0;
  };

  // Set up for list.js
  var options = {
    valueNames: [ 'system', 'sorn-id', 'pii', 'type' ],
    page: 10,
    pagination: [{
        innerWindow: 1,
        outerWindow: 1
    }]
  };

  var list = new List('cards', options);

  // pointers to form elements
  const systemSearch = $("#system-field");
  const sornSearch = $("#sorn-field");
  const piiSearch = $("#pii-field");
  const piaCheckbox = $("#filter__PIA")
  const sornCheckbox = $("#filter__SORNS")
  const ssnCheckbox = $("#filter__SSN")
  const emailCheckbox = $("#filter__email")
  const searches = [systemSearch, sornSearch, piiSearch]
  const checkboxes = [piaCheckbox, sornCheckbox, ssnCheckbox, emailCheckbox]

  // Set up page data
  var SearchFilterData = {
    ssnFilter: null,
    emailFilter: null,
    systemFilter: null,
    sornFilter: null,
    piiFilter: null,
    generalSearch: null
  };

  // listener: after search, get the result count
  list.on('searchComplete', function() {
    $("#result-count").text(list.matchingItems.length)
    $("#total-count").text(list.matchingItems.length)
    if (SearchFilterData.searchTerm) {
      var searchTermText = `results for "${SearchFilterData.searchTerm}"`
      $("#search-term").text(searchTermText)
    } else {
      $("#search-term").text('');
    }
  })

  // listener: after filter, get the result count
  list.on('filterComplete', function() {
    $("#result-count").text(list.matchingItems.length)
  })

  // get current input from search fields
  function getTypedFilterValues() {
    SearchFilterData.systemFilter = systemSearch.val().toLowerCase()
    SearchFilterData.sornFilter = sornSearch.val().toLowerCase()
    SearchFilterData.piiFilter = piiSearch.val().toLowerCase()
  }

  // run list.js filter
  function filter() {
    list.filter( function(item) {

      // for each card, get lower case values
      var systemName = item.values()["system"].toLowerCase()
      var sornID = item.values()["sorn-id"].toLowerCase()
      var piiValue = item.values()["pii"].toLowerCase()
      var type = item.values()["type"]

      // Set filter value to true (include) if search text is contained in field
      // OR if there is no value entered in the field
      var systemFilter = systemName.includes(SearchFilterData.systemFilter) || !SearchFilterData.systemFilter
      var sornIdFilter = sornID.includes(SearchFilterData.sornFilter) || !SearchFilterData.sornFilter
      var piiFilter = piiValue.includes(SearchFilterData.piiFilter) || !SearchFilterData.piiFilter

      // document type filters are true (include) by default
      var piaFilter = true
      var sornFilter = true
      var ssnFilter = true
      var emailFilter = true

      // if PIA document type checkbox is not checked, apply filter for that type
      if (piaCheckbox.is(":checked")) {
        //pass
      } else {
        piaFilter = !type.includes("PIA")
      }

      // if SORN document type checkbox is not checked, apply filter for that type
      if (sornCheckbox.is(":checked")) {
        //pass
      } else {
        sornFilter = !type.includes("SORN")
      }

      if (ssnCheckbox.is(":checked")) {
        ssnFilter = piiValue.includes("ssn")
      }

      if (emailCheckbox.is(":checked")) {
        emailFilter = piiValue.includes("email")
      }

      // display item if all conditions are true, otherwise filter
      if (ssnFilter && emailFilter && systemFilter && sornIdFilter && piiFilter && piaFilter && sornFilter) {
        return true;
      } else {
        return false;
      }
    })
  }

  function setActiveFilterTags() {
    // Leaving this duplicated code for now.
    // The typed filters will likely change
    // so clever refactoring would make changes harder
    var tagExists = $("#system-tag").length;
    if (SearchFilterData.systemFilter && !tagExists) {
      systemTagHtml = `<li id="system-tag" class="usa-tag">System: ${SearchFilterData.systemFilter}</li>`
      $("#active-filters").append(systemTagHtml)
    } else if (SearchFilterData.systemFilter && tagExists) {
      $("#system-tag").text(`System: ${SearchFilterData.systemFilter}`)
    } else if (SearchFilterData.systemFilter && tagExists) {
      $("#system-tag").remove()
    }

    tagExists = $("#sorn-tag").length;
    if (SearchFilterData.sornFilter && !tagExists) {
      sornTagHtml = `<li id="sorn-tag" class="usa-tag">sorn: ${SearchFilterData.sornFilter}</li>`
      $("#active-filters").append(sornTagHtml)
    } else if (SearchFilterData.sornFilter && tagExists) {
      $("#sorn-tag").text(`Sorn: ${SearchFilterData.sornFilter}`)
    } else if (SearchFilterData.sornFilter && tagExists) {
      $("#sorn-tag").remove()
    }

    tagExists = $("#pii-tag").length;
    if (SearchFilterData.piiFilter && !tagExists) {
      piiTagHtml = `<li id="pii-tag" class="usa-tag">pii: ${SearchFilterData.piiFilter}</li>`
      $("#active-filters").append(piiTagHtml)
    } else if (SearchFilterData.piiFilter && tagExists) {
      $("#pii-tag").text(`pii: ${SearchFilterData.piiFilter}`)
    } else if (SearchFilterData.piiFilter && tagExists) {
      $("#pii-tag").remove()
    }
  }

  function quickActiveFilters() {
    // Quick filters
    if (ssnCheckbox.is(":checked") && !$("#ssn-tag").length) {
      html = `<li id="ssn-tag" class="usa-tag">PII: SSN</li>`
      $("#active-filters").append(html)
    } else if (!ssnCheckbox.is(":checked") && $("#ssn-tag").length){
      $(`#ssn-tag`).remove()
    }

    if (emailCheckbox.is(":checked") && !$("#email-tag").length) {
      html = `<li id="email-tag" class="usa-tag">PII: email</li>`
      $("#active-filters").append(html)
    } else if (!emailCheckbox.is(":checked") && $("#email-tag").length) {
      $(`#email-tag`).remove()
    }
  }

  function highlight() {
    // highlight matching search results
    $('ul.pii li.highlight').removeClass('highlight');
    if (SearchFilterData.piiFilter) {
      $(`ul.pii li:icontains(${SearchFilterData.piiFilter})`).addClass('highlight')
    }

    if (ssnCheckbox.is(":checked")) {
      $(`ul.pii li:icontains(SSN)`).addClass('highlight')
    }

    if (emailCheckbox.is(":checked")) {
      $(`ul.pii li:icontains(email)`).addClass('highlight')
    }

    if (SearchFilterData.searchTerm) {
      $(`ul.pii li:icontains(${SearchFilterData.searchTerm})`).addClass('highlight')
    }
  }

  // bind checkbox click() action to trigger the filter() function
  checkboxes.forEach(
    checkbox => checkbox.click( function() {
      getTypedFilterValues()
      filter()
      quickActiveFilters()
      highlight()
    })
  )

  // const searches = [systemSearch, sornSearch, piiSearch]
  // Bind keypresses on each of the search boxes
  searches.forEach(
    search => search.keyup( function() {
      applyFilters()
      highlight()
    })
  )

  function applyFilters() {
    // Get contents of the search boxes
    getTypedFilterValues()
    // filter the main list
    filter()
    // Make the active filter tags for each filter box
    setActiveFilterTags()
  }

  $("#general-search-button").click(function(){
    SearchFilterData.searchTerm = $("#general-search").val()
    list.filter()
    list.search(SearchFilterData.searchTerm)
    applyFilters()

    highlight()
  })

})

</script>

<!-- Set up Jekyll Data -->

{% if jekyll.environment == 'test' %}
  <div id="jekyll-env">{{ jekyll.environment }}</div>
  {% assign rows = site.data.test-inventory | sort: "System Name" %}
{% else %}
  {% assign rows = site.data.pii-inventory | sort: "System Name" %}
{% endif %}

  <div class="grid-container">
    <div class="grid-row grid-gap">
      <div class="usa-list desktop:grid-col-3">
        <div class="filter_section padding-2">
          <ul class="margin-top-0">
            <li>
              <span><strong>FILTERS</strong></span>
            </li>
            <li>
              <span>QUICK FILTERS</span>
            </li>
            <li>
              <div class="usa-checkbox float-left margin-right-2 bg-base-lighter checkbox-tags">
                <input class="usa-checkbox__input" type="checkbox" id="filter__SSN" name="SSN" value="SSN">
                <label class="usa-checkbox__label margin-bottom-0" id="filter__SSN_label" for="filter__SSN">SSN</label>
              </div>
              <div class="usa-checkbox float-left margin-right-2 bg-base-lighter checkbox-tags">
                <input class="usa-checkbox__input" type="checkbox" id="filter__email" name="Email" value="Email">
                <label class="usa-checkbox__label margin-bottom-0" id="filter__email_label" for="filter__email">email</label>
              </div>
            </li>
           </ul>

           <ul class="margin-top-8">
             <hr class="margin-bottom-2">
            <li class="margin-bottom-05">
              <span>CUSTOM FILTERS</span>
            </li>
            <li>
              <span><strong>TYPE</strong></span>
            </li>
            <li>
              <div class="usa-checkbox float-left margin-right-2">
                <input class="usa-checkbox__input" type="checkbox" id="filter__SORNS" name="SORN" value="SORN" checked>
                <label class="usa-checkbox__label" id="filter__SORN_label" for="filter__SORNS">SORN</label>
              </div>
            </li>
            <li>
              <div class="usa-checkbox float-left">
                <input class="usa-checkbox__input" type="checkbox" id="filter__PIA" name="PIA" value="PIA" checked>
                <label class="usa-checkbox__label" id="filter__PIA_label" for="filter__PIA">PIA</label>
              </div>
            </li>
          </ul>
          <br>
          <ul class="margin-top-1 margin-bottom-0">
            <li>
              <label class="" for="search-field">System</label>
              <input class="usa-input" id="system-field" type="input" name="system">
            </li>
            <li>
              <label class="" for="search-field">SORN ID</label>
              <input class="usa-input" id="sorn-field" type="input" name="sorn id">
            </li>
            <li>
              <label class="" for="search-field">PII</label>
              <input class="usa-input" id="pii-field" type="input" name="PII">
            </li>
          </ul>

        </div>

      </div> <!--filter_section-->

      <main class="usa-layout-docs__main desktop:grid-col-9 usa-prose usa-layout-docs" id="main-content">
        <div class="grid-row margin-top-2 margin-right-0">
          <div class="grid-col-12">
            <form class="usa-search" role="search" onsubmit="return false">
              <input class="usa-input" id="general-search" type="search" name="search">
              <button id="general-search-button" class="usa-button" type="submit">
                <span class="usa-search__submit-text">Search</span>
              </button>
            </form>
          </div>

        </div>
        <div class="grid-row margin-top-2 margin-right-0 results-meta">
          <div class="grid-col-7 display-inline results-meta__filters">
            <span class="font-body-xs text-uppercase text-bold text-ls-1 "> Active filters: </span>
            <ul id="active-filters" class="margin-top-05 margin-bottom-05 padding-0">
            </ul>
          </div>

          <div class="grid-col-5 margin-bottom-0 text-right results-meta__count">
             <div id="search-result-counter" class="font-body-xs">
              Showing <span id="result-count" class="text-bold">{{ rows.size }}</span> of <span id="total-count" class="text-bold">{{ rows.size }}</span> <span id="search-term"></span>
            </div>
          </div>
        </div>
        <hr class="margin-right-0">
        <div id="cards">
          <div class="list">

          {% for row in rows %}
            <div class="card padding-2 margin-top-2 margin-right-0">
              <div class="grid-row margin-bottom-105">
                <span class="system font-heading-lg text-blue">{{ row['System Name'] }}</span>
              </div>
              <!-- <ul class="padding-0"> -->
                <div class="grid-row margin-bottom-105">
                  <div class="grid-col-2">
                    <strong style="color:#5B5B5B">Type:</strong>
                  </div>
                  <div class="type grid-col-10">
                    {{ row['Type'] }}
                  </div>
                </div>
                <div class="grid-row margin-bottom-105">
                  <div class="grid-col-2">
                    <strong style="color:#5B5B5B">SORN ID:</strong>
                  </div>
                  <div class="sorn-id grid-col-10">
                    {{ row['SORN ID']}}
                  </div>
                </div>
              <!-- </div> -->

              <div class="grid-row margin-bottom-105">
                <div class="grid-col-2">
                  {% if row['Type'] == "SORN"%}
                  <strong style="color:#5B5B5B">Categories<br>of Record:</strong>
                  {% else %}
                  <strong style="color:#5B5B5B">PII:</strong>
                  {% endif %}
                </div>
                <div class="grid-col-10">
                  <ul class="pii">
                    {% assign pii = row['PII'] | split: "," | sort_natural %}
                    {% for i in pii %}
                      <li><span>{{i}}</span></li>
                    {% endfor %}
                  </ul>
                </div>
              </div>


              <a href="{{ row['URL'] }}" target="_blank" class="usa-link">Source</a>

            </div>
          {% endfor %}
          </div>
          <ul class="pagination"></ul>
        </div>
      </main>

    </div> <!--grid-row-->
  </div> <!--grid-container-->
