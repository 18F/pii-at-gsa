<script
  src="https://code.jquery.com/jquery-3.4.1.min.js"
  integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
  crossorigin="anonymous"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/list.js/1.5.0/list.min.js"></script>
<script>



$(function () {

  console.log("READY!")
  $("#loader").hide()

  var jekyll_env = "{{jekyll.environment}}"
  if (jekyll_env == "test") {
    var page_number = 2
  } else {
    var page_number = 10
  }

  // Set up for list.js
  var options = {
    valueNames: [ 'agency_name', 'system_name', 'authority', 'categories_of_record' ],
    page: page_number,
    pagination: [{
        innerWindow: 1,
        outerWindow: 1
    }]
  };

  var list = new List('cards', options);

  var generalSearch = null

  $("#general-search-button").click(function(){
    generalSearch = $("#general-search").val()
    list.search(generalSearch)
  })

   // listener: after search, get the result count
   list.on('searchComplete', function() {
    $("#result-count").text(list.matchingItems.length)
    $("#total-count").text(list.matchingItems.length)
    $("#search-term").text(`results for "${generalSearch}"`)
  })

  list.on('updated', function() {
    // highlight here to run on pagination page loads
    highlight()
  })

  function highlight() {
    $(".highlight").removeClass("highlight")

    sections = ['.agency_name', '.system_name', '.authority', '.categories_of_record' ]
    sections.forEach(section => sectionHighlight(section))
  }

  function sectionHighlight(section) {
    var reg = new RegExp(generalSearch, "gi");
    $(section).each(function(){
      h = $(this).html().replace(reg, `<span class="highlight">${generalSearch}</span>`)
      $(this).html(h)
    })
  }
})

</script>